<div class="card mt-4 py-3 px-3 exported-variables w-100">
    <dx-data-grid #versionsGrid class="data-grid-search processes status-grid" [dataSource]="formattedVersions" keyExpr="id" [allowColumnResizing]="true" [allowColumnReordering]="true" [showBorders]="false" [showRowLines]="false" [columnMinWidth]="150" [hoverStateEnabled]="true"
        [remoteOperations]="true" [wordWrapEnabled]="true" [columnAutoWidth]="false" columnResizingMode="widget" [noDataText]="version?.length === 0 ? 'no data' : ''" (onCellPrepared)="onCellPrepared($event)" (onRowInserting)="onRowInserting($event)" (onRowUpdating)="onRowUpdating($event)"
        (onRowRemoving)="onRowRemoving($event)" (onCellClick)="redirectToDetails($event)" (onEditorPreparing)="onEditorPreparing($event)" [(selectedRowKeys)]="selectedRows" (onSelectionChanged)="selectionChangedHandler()" (onEditCanceled)="cancelHandler()">

        <dxo-selection
            [selectAllMode]="'allMode'"
            [showCheckBoxesMode]="'always'"
            mode="multiple"
        ></dxo-selection>

        <dxo-paging [pageSize]="10"></dxo-paging>
        <dxo-pager [visible]="true" [showPageSizeSelector]="true" [allowedPageSizes]="[6, 12, 24]" [showNavigationButtons]="true">
        </dxo-pager>

        <!-- Filtering & Sorting settings -->
        <dxo-header-filter [visible]="true"></dxo-header-filter>
        <dxo-filter-row [visible]="true"></dxo-filter-row>
        <dxo-search-panel [visible]="true" [width]="320"></dxo-search-panel>
        <dxo-sorting mode="single"></dxo-sorting>

        <!-- Editing settings -->
        <dxo-editing [allowAdding]="true" [allowUpdating]="true" [allowDeleting]="true" mode="row" refreshMode="reshape" [useIcons]="true">
        </dxo-editing>
        <dxo-filter-panel [visible]="true"></dxo-filter-panel>

        <dxo-export [enabled]="true"></dxo-export>

        <!-- Column chooser settings -->
        <dxo-column-chooser [enabled]="true" mode="dragAndDrop"></dxo-column-chooser>

        <!-- Toolbar setup -->
        <dxo-toolbar>
            <!-- Search Panel -->
            <dxi-item location="before" name="searchPanel"></dxi-item>
            <dxi-item location="before" name="addRowButton"></dxi-item>
            <dxi-item location="before" name="exportButton"></dxi-item>
            <dxi-item location="before" name="columnChooserButton"></dxi-item>
            <dxi-item location="before" name="columnChooserButton">
                <div *dxTemplate>
                    <button [disabled]="!hasSelectedRows()"
                        (click)="deleteSelectedRows()" 
                        class="btn btn-danger ms-auto d-flex align-items-center gap-2">
                        {{ 'table.delete-selected' | translate }}
                    </button>
                </div>
            </dxi-item>
            <!-- Create Button -->
            <dxi-item location="after" locateInMenu="auto">
                <div *dxTemplate>
                    <button (click)="onAddClick()" class="btn btn-plain-text ms-auto d-flex align-items-center gap-2 p-1">
                        {{ 'version.create-version' | translate }} <i
                            class="bi bi-plus-circle-fill text-success font-size-2 lh-1"></i>
                    </button>
                </div>
            </dxi-item>
            <dxi-item location="before">
                <dx-button
                [text]="'table.clear-selection' | translate"
                  [disabled]="!selectedRows?.length"
                  (onClick)="grid$.instance.clearSelection()"
                >
                </dx-button>
            </dxi-item>
        </dxo-toolbar>
        <!-- Columns definition -->
        <dxi-column dataField="formattedVersion" dataType="string" [caption]="'version.version' | translate">
            <dxi-validation-rule type="required"></dxi-validation-rule>
            <dxi-validation-rule type="pattern" [message]="'incorrect-format' | translate" [pattern]="patternVersion"></dxi-validation-rule>
        </dxi-column>
        <dxi-column dataField="description" dataType="string" [caption]="'version.description' | translate">
            <dxi-validation-rule type="required"></dxi-validation-rule>
        </dxi-column>
        <dxi-column dataField="total_duration" dataType="number" cellTemplate="durationCellTemplate" [caption]="'version.total-duration' | translate" [allowEditing]="false">
            <div *dxTemplate="let cellData of 'durationCellTemplate'">
                <div *ngIf="cellData.value">{{ formatDuration(cellData.value) }}</div>
            </div>
        </dxi-column>
        <dxi-column dataField="total_num_people" dataType="number" [caption]="'version.total-num-people' | translate" [allowEditing]="false">
        </dxi-column>
        <dxi-column dataField="grade" dataType="number" [caption]="'version.grade' | translate">
            <dxi-validation-rule type="required"></dxi-validation-rule>
            <dxi-validation-rule type="pattern" [message]="'positive-number' | translate" [pattern]="patternPositive"></dxi-validation-rule>
        </dxi-column>
        <dxi-column cellTemplate="versionCellTemplate" dataField="status" [caption]="'version.status' | translate" [editorOptions]="editorOptions">
            <dxo-lookup [dataSource]="VERSION_STATUSES" displayExpr="name" valueExpr="id">
            </dxo-lookup>
            <div *dxTemplate="let cellData of 'versionCellTemplate'">
                {{VERSION_STATUSES[cellData.value].name | translate }}
            </div>
            <div *dxTemplate="let data of 'versionFieldTemplate'">
                <dx-text-box [value]="data?.name | translate"></dx-text-box>
            </div>
            <div *dxTemplate="let data of 'versionItemTemplate'">
                {{ data?.name  | translate }}
            </div>
            <dxi-validation-rule type="required"></dxi-validation-rule>
        </dxi-column>
        <dxi-column dataField="created_at" dataType="date" [caption]="'version.created' | translate" [allowEditing]="false">
        </dxi-column>
        <dxi-column dataField="updated_at" dataType="date" [caption]="'version.updated' | translate" [allowEditing]="false">
        </dxi-column>
        <dxi-column type="buttons" [width]="110">
            <dxi-button name="edit" [disabled]="actionVisible"></dxi-button>
            <dxi-button name="delete" [disabled]="actionVisible"></dxi-button>
        </dxi-column>
    </dx-data-grid>
</div>
<app-confirmation-popup [title]="'version.delete-version' | translate" [description]="'version.delete-version-description' | translate" [(popupVisible)]="confirmationVisible" (changeConfirmed)="confirmProcessRemoval()">
</app-confirmation-popup>